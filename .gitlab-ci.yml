cache:
  key: "$CI_PROJECT_ID"
  paths:
  - node_modules/

stages:
- build
- deploy

building:
  stage: build
  variables:
    NODE_ENV: "production"
  script:
  - npm i --no-optional
  - npm run build
  artifacts:
    expire_in: 1 hour
    paths:
    - .nuxt/dist
  only:
  - master

deploy:
  stage: deploy
  only:
  - master
  script:
  - cp -R ./.nuxt/dist/* /opt/app/myongoingscalendar-frontend/
  - cp -f ./vibrant.js /opt/app/
  - cp -f ./webp.js /opt/app/
  - cp -f ./ecosystem.config.js /opt/app/
  - npm i pm2 -g
  - npm i express -g
  - npm i node-vibrant -g
  - npm i webp-converter -g
  - cd /opt/app
  - pm2 restart ecosystem.config.js
  tags:
  - shell
